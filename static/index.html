<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Deep Research Tool</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-black text-gray-100 min-h-screen p-8">

  <div class="max-w-3xl mx-auto">

    <h1 class="text-3xl font-bold mb-6 text-center text-white">
      Deep Research Tool
    </h1>

    <label class="text-sm font-semibold text-gray-300">Enter Research Question</label>
    <textarea id="query"
      class="w-full p-3 bg-gray-900 border border-gray-700 rounded mt-1 text-gray-100"
      rows="4"
      placeholder="Example: impact of AI in healthcare"></textarea>

    <button onclick="runResearch()"
      class="mt-4 w-full bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
      Run Research
    </button>

    <p id="loading" class="mt-3 text-blue-400 hidden">
      ‚è≥ Running deep research...
    </p>

    <div id="results" class="mt-8 space-y-6"></div>

  </div>

  <script>
    function formatResearchResult(data) {
      let html = "";

      // SECTIONS
      html += `<h2 class="text-2xl font-bold text-white mb-3">Sections</h2>`;
      data.sections.forEach(sec => {
        html += `
          <div class="bg-gray-900 border border-gray-700 p-4 rounded">
            <h3 class="text-lg font-semibold text-blue-300 mb-2">Section ${sec.order}</h3>
            <p class="text-gray-200 whitespace-pre-wrap">${sec.content}</p>
          </div>
        `;
      });

      // CONCLUSION
      html += `
        <div class="bg-gray-900 border border-gray-700 p-4 rounded">
          <h2 class="text-2xl font-bold text-white mb-3">Conclusion</h2>
          <p class="text-gray-200 whitespace-pre-wrap">${data.conclusion}</p>
        </div>
      `;

      // CITATIONS
      html += `
        <div class="bg-gray-900 border border-gray-700 p-4 rounded">
          <h2 class="text-2xl font-bold text-white mb-3">Citations</h2>
      `;

      data.citations.forEach(c => {
        html += `
          <p class="text-blue-400">
            ${c.id}. <a href="${c.url}" target="_blank" class="underline">${c.url}</a>
          </p>
        `;
      });

      html += `</div>`;

      return html;
    }


    async function runResearch() {
      const query = document.getElementById("query").value;
      const resultsEl = document.getElementById("results");
      const loadingEl = document.getElementById("loading");

      resultsEl.innerHTML = "";
      loadingEl.classList.remove("hidden");

      const response = await fetch("http://127.0.0.1:8000/research", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ query })
      });

      const data = await response.json();
      loadingEl.classList.add("hidden");

      resultsEl.innerHTML = formatResearchResult(data);
    }
  </script>

</body>
</html>
